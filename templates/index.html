{% extends "base.html" %}
{% block title %}Swipe Papers{% endblock %}
{% block content %}
<h1 class="mt-4">Swipe Papers</h1>
<div id="paper-container" class="mt-4">
    <h2 id="paper-title"></h2>
    <p id="paper-summary"></p>
    <div class="mt-3">
        <button id="like-button" class="btn btn-success">Swipe Right</button>
        <button id="dislike-button" class="btn btn-danger">Swipe Left</button>
        <button id="read-button" class="btn btn-primary">Read Now</button>
        <button id="in-review-button" class="btn btn-secondary">Move to In Review</button>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
let start = 0;

function getNextPaper() {
    fetch(`/get_paper?start=${start}`)
    .then(response => response.json())
    .then(data => {
        if (data.status === 'ok') {
            displayPaper(data);
            start = data.next_start;
        } else {
            document.getElementById('paper-container').innerHTML = '<p>No more papers available.</p>';
        }
    });
}

function displayPaper(paper) {
    document.getElementById('paper-title').textContent = paper.title;
    let summaryElement = document.getElementById('paper-summary');
    let summaryText = paper.summary;

    // Detect mobile device
    let isMobile = window.matchMedia("only screen and (max-width: 768px)").matches;

    if (isMobile) {
        // Remove newlines for mobile devices
        summaryText = summaryText.replace(/\n/g, ' ');
    }

    summaryElement.textContent = summaryText;

    // Store current paper data
    window.currentPaper = paper;
}

function sendReview(action) {
    fetch('/review_paper', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            paper_id: window.currentPaper.paper_id,
            action: action,
            title: window.currentPaper.title,
            summary: window.currentPaper.summary,
            link: window.currentPaper.link
        })
    })
    .then(response => response.json())
    .then(data => {
        getNextPaper();
    });
}

// Event listeners for buttons
document.getElementById('like-button').onclick = () => sendReview('like');
document.getElementById('dislike-button').onclick = () => sendReview('dislike');
document.getElementById('read-button').onclick = () => {
    sendReview('read');
    let paperId = window.currentPaper.paper_id.replace('http://', '');
    window.location.href = `/view_paper/${paperId}`;
};
document.getElementById('in-review-button').onclick = () => sendReview('in_review');

// Initialize by fetching the first paper
getNextPaper();
</script>
{% endblock %}

